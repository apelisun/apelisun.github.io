<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>mysql1 | ape_li</title>

  <!-- keywords -->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="数据库介绍 按照一定的数据结构来组织,管理和存储数据的仓库 用仓库的方式来管理数据的.一个仓库下会有很多表.一个表由行和列构成.  数据的分类  关系型数据库  表格型数据库 - 有行和列来构成一张表,表中存放数据 常见的产品:MS-sqlserver,主流的免费的Oracle-mysql(中小型的应用),收费的Oracle-oracle(大型的应用)  nosql - 不仅仅是sql - 非关系">
<meta property="og:type" content="article">
<meta property="og:title" content="mysql1">
<meta property="og:url" content="https://apelisun.github.io/2022/08/09/mysql1/index.html">
<meta property="og:site_name" content="ape_li">
<meta property="og:description" content="数据库介绍 按照一定的数据结构来组织,管理和存储数据的仓库 用仓库的方式来管理数据的.一个仓库下会有很多表.一个表由行和列构成.  数据的分类  关系型数据库  表格型数据库 - 有行和列来构成一张表,表中存放数据 常见的产品:MS-sqlserver,主流的免费的Oracle-mysql(中小型的应用),收费的Oracle-oracle(大型的应用)  nosql - 不仅仅是sql - 非关系">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-08-09T13:22:47.000Z">
<meta property="article:modified_time" content="2022-08-10T03:46:46.267Z">
<meta property="article:author" content="ape_li">
<meta property="article:tag" content="mysql">
<meta property="article:tag" content="数据库基础">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="ape_li" type="application/atom+xml">
  
  
    <link rel="icon" href="/img/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  

  
<script src="//cdn.bootcss.com/require.js/2.3.2/require.min.js"></script>

  
<script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>


  
<meta name="generator" content="Hexo 6.2.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>
<body>
  <div id="container">
    <div id="particles-js"></div>
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
				<img lazy-src="/img/header.jpg" class="js-avatar">
			
		</a>

		<hgroup>
			<h1 class="header-author"><a href="/">ape_li</a></h1>
		</hgroup>

		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">目录</a></li>
				        
						</ul>
					</nav>
					<nav class="half-header-menu">
						<a class="hide">Home</a>
						<a>Tags</a>
						<a>Links</a>
						<a>About</a>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
						<!-- music -->
						
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/B-%E6%A0%91/" style="font-size: 10px;">B+树</a> <a href="/tags/area/" style="font-size: 10px;">area</a> <a href="/tags/collection/" style="font-size: 10px;">collection</a> <a href="/tags/homework/" style="font-size: 10px;">homework</a> <a href="/tags/index/" style="font-size: 10px;">index</a> <a href="/tags/interview/" style="font-size: 10px;">interview</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/meet-DB/" style="font-size: 10px;">meet DB</a> <a href="/tags/msql/" style="font-size: 10px;">msql</a> <a href="/tags/mysql/" style="font-size: 20px;">mysql</a> <a href="/tags/procedure/" style="font-size: 10px;">procedure</a> <a href="/tags/view/" style="font-size: 10px;">view</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/" style="font-size: 10px;">数据库基础</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="https://github.com/">github</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">I&#39;m a developer.</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/header.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author"></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">目录</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-mysql1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2022/08/09/mysql1/" class="article-date">
  	<time datetime="2022-08-09T13:22:47.000Z" itemprop="datePublished">2022-08-09</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      mysql1
      
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/" rel="tag">mysql</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/" rel="tag">数据库基础</a></li></ul>
	</div>

        

        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="数据库介绍"><a href="#数据库介绍" class="headerlink" title="数据库介绍"></a>数据库介绍</h1><blockquote>
<p>按照一定的数据结构来组织,管理和存储数据的仓库</p>
<p>用仓库的方式来管理数据的.一个仓库下会有很多表.一个表由行和列构成.</p>
</blockquote>
<h2 id="数据的分类"><a href="#数据的分类" class="headerlink" title="数据的分类"></a>数据的分类</h2><blockquote>
<ol>
<li><p>关系型数据库 </p>
<p><code>表格型数据库 - 有行和列来构成一张表,表中存放数据</code></p>
<p>常见的产品:MS-sqlserver,主流的免费的Oracle-mysql(中小型的应用),收费的Oracle-oracle(大型的应用)</p>
</li>
<li><p>nosql - 不仅仅是sql - 非关系型数据库</p>
<ul>
<li>键值对数据库 - redis</li>
<li>文档型数据库 - mongodb</li>
<li>列式数据库 - hbase</li>
<li>图形数据库</li>
</ul>
</li>
</ol>
</blockquote>
<h2 id="数据库安装注意点"><a href="#数据库安装注意点" class="headerlink" title="数据库安装注意点"></a>数据库安装注意点</h2><blockquote>
<ol>
<li><p>server和client</p>
<p>当我们安装好db之后,自带安装好了mysql-server端和mysql-client端</p>
<p><code>db正常使用,一定要保障mysql-server端处于运行状态</code></p>
<ul>
<li><p>右击计算机 - 管理 - 服务 - 服务和应用程序 - 👉🏻右边窗口 - Mysql - 启动方式设置开启自启.</p>
</li>
<li><p>可以通过终端输入命令来启动mysql-server端</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net start mysql</span><br><span class="line">net stop mysql</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li>mysql-client客户端<ul>
<li>第三方的收费navicat</li>
<li>idea</li>
<li>java代码</li>
<li>自带的控制台</li>
</ul>
</li>
</ol>
</blockquote>
<h2 id="专业术语"><a href="#专业术语" class="headerlink" title="专业术语"></a>专业术语</h2><blockquote>
<ol>
<li><p>DB - DataBase 数据库</p>
</li>
<li><p>DBA - 数据库管理员(侧重于运维),DE - 数据库研发工程师</p>
</li>
<li><p>DBMS - 数据库管理系统,安装在操作系统.用户通过dbms来操作db,dba通过dbms来管理db,保证db在7*24h高效运转</p>
<p><code>人 - dbms - db(os)</code></p>
</li>
<li><p>RDBMS - 关系型数据库管理系统 </p>
</li>
<li><p>DBS - 数据库系统,大的范畴,dbs = dba+db+dbms</p>
</li>
</ol>
</blockquote>
<h2 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h2><blockquote>
<p><code>前提:mysql安装并且配置好了环境变量</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u用户名 -p密码</span><br></pre></td></tr></tbody></table></figure>

<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -proot</span><br></pre></td></tr></tbody></table></figure>

<p><code>修改密码</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">alter user '用户名'@'db所在主机ip' identified by '新的密码';</span><br><span class="line"></span><br><span class="line">use mysql</span><br><span class="line"></span><br><span class="line">alter user 'root'@'localhost' identified by 'root';</span><br><span class="line"></span><br><span class="line">-- 退出重新登录</span><br><span class="line">exit;</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<h2 id="导入脚本"><a href="#导入脚本" class="headerlink" title="导入脚本"></a>导入脚本</h2><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">-- 1. 创建数据库  create dabatase 数据库名</span><br><span class="line">create database dy;</span><br><span class="line"></span><br><span class="line">-- 查看所有的db</span><br><span class="line">show databases;</span><br><span class="line"></span><br><span class="line">-- 2. 使用数据库</span><br><span class="line">use dy</span><br><span class="line"></span><br><span class="line">-- 3. 导入脚本 - .sql为后缀的sql文件</span><br><span class="line">-- 3-1. 在dy数据库中生成5张表</span><br><span class="line">-- 3-2. 每张表中模拟一些数据</span><br><span class="line">source 脚本文件的绝对路径;</span><br><span class="line"></span><br><span class="line">-- 4. 查看该库下所有的表</span><br><span class="line">show tables;</span><br><span class="line"></span><br><span class="line">+--------------+</span><br><span class="line">| Tables_in_dy |</span><br><span class="line">+--------------+</span><br><span class="line">| s_customer   |</span><br><span class="line">| s_dept       |</span><br><span class="line">| s_emp        |</span><br><span class="line">| s_ord        |</span><br><span class="line">| s_region     |</span><br><span class="line">+--------------+</span><br><span class="line"></span><br><span class="line">--5. 查看表结构</span><br><span class="line">desc s_emp</span><br></pre></td></tr></tbody></table></figure>

<h2 id="设置数据库编码"><a href="#设置数据库编码" class="headerlink" title="设置数据库编码"></a>设置数据库编码</h2><blockquote>
<ol>
<li><p>查看编码</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">show variables like 'character_set%';</span><br><span class="line"></span><br><span class="line">+--------------------------+-----------------------------------------------------------+</span><br><span class="line">| Variable_name            | Value                                                     |</span><br><span class="line">+--------------------------+-----------------------------------------------------------+</span><br><span class="line">| character_set_client     | utf8                                                      |</span><br><span class="line">| character_set_connection | utf8                                                      |</span><br><span class="line">| character_set_database   | utf8                                                      |</span><br><span class="line">| character_set_filesystem | binary                                                    |</span><br><span class="line">| character_set_results    | utf8                                                      |</span><br><span class="line">| character_set_server     | utf8                                                      |</span><br><span class="line">| character_set_system     | utf8                                                      |</span><br><span class="line">| character_sets_dir       | /usr/local/mysql-5.7.28-macos10.14-x86_64/share/charsets/ |</span><br><span class="line">+--------------------------+-----------------------------------------------------------+</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>修改编码</p>
<p>2-1. 临时修改 - set命令 - 仅仅是对当前会话(一次连接,窗口)有效</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set names utf8;</span><br></pre></td></tr></tbody></table></figure>

<p>2-2. 永久生效 - 找到<strong>my.ini文件</strong></p>
<figure class="highlight ini"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[client]</span></span><br><span class="line"><span class="comment"># 设置mysql客户端默认字符集</span></span><br><span class="line"><span class="attr">default-character-set</span>=utf8</span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"><span class="attr">character_set_server</span>=utf8</span><br></pre></td></tr></tbody></table></figure>

<p>需要重启mysql-server(mysql服务器端),才能生效.</p>
<ol>
<li><p>通过gui方式</p>
</li>
<li><p>通过命令</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net stop mysql</span><br><span class="line">net start mysql</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</li>
</ol>
</blockquote>
<h2 id="SQL介绍"><a href="#SQL介绍" class="headerlink" title="SQL介绍"></a>SQL介绍</h2><blockquote>
<p>SQL 是 Structured Query Language 的缩写，中文译为“结构化查询语言”。SQL 是一种计算机语言，用来存储、检索和修改关系型数据库中存储的数据。</p>
<p>①mysql-client输入合法的sql语句,如果sql非法,直接报错</p>
<p>②输入回车- 客户端将sql语句发送到mysql-server端,编译和解析sql语句的.</p>
<p>③mysql-server将执行完sql语句的结果返回到mysql-client进行展示.</p>
</blockquote>
<h3 id="按照功能SQL分类"><a href="#按照功能SQL分类" class="headerlink" title="按照功能SQL分类"></a>按照功能SQL分类</h3><blockquote>
<ol>
<li><p>DDL(Data Definition Language) - 数据定义语言</p>
<p>create drop alter truncate rename comment(注释)</p>
</li>
<li><p>DML(Data Manipulation Language) - 数据操纵语言</p>
<p>update delete insert</p>
</li>
<li><p>DQL(Data Query Language) - 数据查询语言</p>
<p>select</p>
</li>
<li><p>TCL/DTL(Transaction Control Language):事务控制语言</p>
<p>commit savepoint rollback</p>
</li>
</ol>
</blockquote>
<h1 id="简单查询"><a href="#简单查询" class="headerlink" title="简单查询"></a>简单查询</h1><blockquote>
<ol>
<li><p>查询的本质</p>
<ul>
<li>到哪里查</li>
<li>查什么</li>
</ul>
</li>
<li><p>语法 - 关键字是大小写不敏感</p>
<figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 列名<span class="number">1</span>,列名<span class="number">2</span>,..列n</span><br><span class="line"><span class="keyword">FROM</span> 表名;</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</blockquote>
<h2 id="列取别名"><a href="#列取别名" class="headerlink" title="列取别名"></a>列取别名</h2><blockquote>
<ol>
<li><p>查询员工的名字,薪水以及职称.</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select first_name,salary,title from s_emp;</span><br></pre></td></tr></tbody></table></figure>

<p><code>方式一</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT 列名1 列别名,列名2 列别名,..列n</span><br><span class="line">FROM 表名;</span><br><span class="line"></span><br><span class="line">select first_name 名字,salary 薪水,title 职称 from s_emp;</span><br></pre></td></tr></tbody></table></figure>

<p><code>方式二</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT 列名1 as 列别名,列名2 as 列别名,..列n</span><br><span class="line">FROM 表名;</span><br><span class="line"></span><br><span class="line">select first_name as 名字,salary as 薪水,title as 职称 from s_emp;</span><br></pre></td></tr></tbody></table></figure>

<p><code>方式三</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">列别名中间有空格,需要使用双引号来包裹格式</span><br><span class="line">select first_name "名 字",salary "薪 水",title as "职 称" from s_emp;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>查询所有列*</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-- 格式化输出</span><br><span class="line">select * from s_emp;</span><br><span class="line">   </span><br><span class="line">select * from s_emp \G;</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</blockquote>
<h2 id="去重关键字"><a href="#去重关键字" class="headerlink" title="去重关键字"></a>去重关键字</h2><blockquote>
<p>distinct</p>
<ol>
<li><p>查询员工表中所有的职称的信息</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select distinct title from s_emp;</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</blockquote>
<h2 id="列的计算"><a href="#列的计算" class="headerlink" title="列的计算"></a>列的计算</h2><blockquote>
<p>列是允许计算的</p>
<ol>
<li><p>查询员工的名字,年薪(不带提成commission_pct)</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select first_name,salary*12 年薪 from s_emp;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>查询员工的名字,年薪(带提成commission_pct)</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select first_name,salary*(1+commission_pct/100)*12 年薪 from s_emp;</span><br><span class="line">   </span><br><span class="line">查询出来只有5个人有年薪,原因是因为只有5个人有提成.其他人的提成都是null值</span><br><span class="line">mysql - null值计算的结果还是一个null值</span><br><span class="line">   </span><br><span class="line">使用到mysql中提供的空值置换函数</span><br><span class="line">coalesce(m,n) - 如果m为null,返回n,否则返回m</span><br><span class="line">   </span><br><span class="line">select first_name,salary*(1+coalesce(commission_pct,0)/100)*12 年薪 from s_emp;</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</blockquote>
<h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><blockquote>
<ol>
<li><p>找出员工的姓名,工资以及入职日期</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select last_name,first_name,salary,start_date from s_emp;</span><br><span class="line"></span><br><span class="line">-- 列的拼接 concat(m,n,a,b,c,..)</span><br><span class="line">-- mysql中的字符串统一使用单引号</span><br><span class="line">select concat(last_name,'  ',first_name) 姓名,salary,start_date from s_emp;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>找出所有的客户名以及他的联系方式</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select name,phone from s_customer;</span><br><span class="line"></span><br><span class="line">-- 查询姓名的时候</span><br><span class="line">-- 蔡根花 - 蔡**</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>找出每个订单的费用,支付方式以及出货日期</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select total,payment_type,date_ordered from s_ord;</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</blockquote>
<h2 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h2><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT 列名1,列名2,..列n</span><br><span class="line">FROM 表名</span><br><span class="line">WHERE 条件表达式;</span><br></pre></td></tr></tbody></table></figure>

<h3 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h3><p><code>比较运算符</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; &lt; &gt;= &lt;= != &lt;&gt; =</span><br></pre></td></tr></tbody></table></figure>

<p><code>其他运算符</code></p>
<blockquote>
<ol>
<li>between …  and ..  在…到…之间</li>
<li>in(集合) - 在某个集合内</li>
<li>not in(集合) - 不在某个集合内</li>
<li>is - 判断是否为null,判断null值不能用=</li>
<li>is not - 判断是否不为null</li>
</ol>
</blockquote>
<p><code>逻辑连接符</code></p>
<blockquote>
<ol>
<li>and 条件同时成立,返回true</li>
<li>or 有一个条件成立,就返回true</li>
</ol>
</blockquote>
<h3 id="练习-1"><a href="#练习-1" class="headerlink" title="练习"></a>练习</h3><blockquote>
<ol>
<li><p>查询部门编号(dept_id)为41,42,45的员工找出来</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select first_name,dept_id from s_emp</span><br><span class="line">where dept_id=41 or dept_id=42 or dept_id=45;</span><br><span class="line"></span><br><span class="line">select first_name,dept_id from s_emp where dept_id in(41,42,45);</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>查询没有提成的员工</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select first_name,commission_pct from s_emp where commission_pct is null;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>找出工资在[1200,1500]之间的员工</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select first_name,salary from s_emp where salary between 1200 and 1500;</span><br><span class="line"></span><br><span class="line">-- 更加灵活</span><br><span class="line">select first_name,salary from s_emp where salary&gt;=1200 and salary&lt;=1500;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>查找工资大于1500并且没有提成的员工</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select first_name,salary from s_emp where salary&gt;1500 and commission_pct is null;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>查找年薪(包括提成)超过15000的员工</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select first_name,salary*(1+coalesce(commission_pct,0)/100)*12 _year from s_emp</span><br><span class="line">where salary*(1+coalesce(commission_pct,0)/100)*12&gt;15000;</span><br><span class="line"></span><br><span class="line">-- 给列取别名的意义</span><br><span class="line">-- 子查询 - 查询的结果作为虚拟表 - 子查询一定要放在()中</span><br><span class="line">select * from X where _year&gt;15000;</span><br><span class="line"></span><br><span class="line">查询的结果来替代X,子查询的结果作为表的话 - 需要给表取别名</span><br><span class="line">select * from (select first_name,salary*(1+coalesce(commission_pct,0)/100)*12 _year from s_emp) core_ where _year&gt;15000;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>找出除了41部门的员工</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select first_name,dept_id from s_emp where dept_id &lt;&gt; 41;</span><br><span class="line"></span><br><span class="line">select first_name,dept_id from s_emp where dept_id not in(41);</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>找出亚洲区域的信息</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- mysql中采用单引号</span><br><span class="line">select * from s_region where name='Asia';</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</blockquote>
<h2 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h2><blockquote>
<p>大小写不敏感的</p>
</blockquote>
<blockquote>
<ol>
<li>关键字like</li>
<li>占位符<ul>
<li>% 代表的任意多个任意字符</li>
<li>_ 代表的是任意单个字符</li>
</ul>
</li>
</ol>
</blockquote>
<h3 id="转义字符"><a href="#转义字符" class="headerlink" title="转义字符"></a>转义字符</h3><blockquote>
<ul>
<li><p>first_name名称正好包含了%或者_</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update s_emp set first_name='Mar%k' where id=4;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>查询first_name包含%的员工</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- 定义转义字符,默认的是\</span><br><span class="line">select first_name from s_emp where first_name like '%\%%';</span><br><span class="line">  </span><br><span class="line">-- 自定义转义字符,用escape 新的转义字符</span><br><span class="line">select first_name from s_emp where first_name like '%?%%' escape '?';</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
</blockquote>
<h3 id="练习-2"><a href="#练习-2" class="headerlink" title="练习"></a>练习</h3><blockquote>
<ol>
<li><p>查询first_name包含m的</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select first_name from s_emp where first_name like '%m%';</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>查询以C开头的员工</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select first_name from s_emp where first_name like 'C%';</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>查询第三个字母是’e’的员工</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select first_name from s_emp where first_name like '__e%';</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>查询入职时间是6月份的员工 - 模糊查询 - 不是正规的</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select first_name,start_date from s_emp where start_date like '%-06-%';</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</blockquote>
<h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT 列名1,列名2,..列n</span><br><span class="line">FROM 表名</span><br><span class="line">WHERE 条件表达式</span><br><span class="line">ORDER By语句 [asc|desc]</span><br><span class="line"></span><br><span class="line">asc可以省略不写 - 升序</span><br><span class="line">desc必须要写 - 降序</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<ol>
<li><p>根据年薪降序排列</p>
<p><code>方式一: order by 列名</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select first_name,salary*(1+coalesce(commission_pct,0)/100)*12 from s_emp </span><br><span class="line">order by salary*(1+coalesce(commission_pct,0)/100)*12 desc;</span><br></pre></td></tr></tbody></table></figure>

<p><code>方式二:</code> order by 列别名</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select first_name,salary*(1+coalesce(commission_pct,0)/100)*12 年薪 from s_emp </span><br><span class="line">order by 年薪 desc;</span><br></pre></td></tr></tbody></table></figure>

<p><code>方式三: order by 列的序号</code>  列的序号从1开始 =&gt; 推荐方式</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select first_name,salary*(1+coalesce(commission_pct,0)/100)*12 年薪 from s_emp </span><br><span class="line">order by 2 desc;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>根据年薪降序排.如果年薪一样,则继续按照first_name升序排列</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select first_name,salary*(1+coalesce(commission_pct,0)/100)*12 年薪 from s_emp </span><br><span class="line">order by 2 desc,1;</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</blockquote>
<h2 id="转换函数"><a href="#转换函数" class="headerlink" title="转换函数"></a>转换函数</h2><h3 id="数字和字符串"><a href="#数字和字符串" class="headerlink" title="数字和字符串"></a>数字和字符串</h3><blockquote>
<ol>
<li><p>字符串转换成数字</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select '1'+0;</span><br><span class="line"></span><br><span class="line">mysql中字符数字遇到数字进行+,自动将字符转换成数字来进行计算.</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>数字转换成字符串 - concat函数 - 拼接删除</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select concat(1,2);  // 12</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</blockquote>
<h3 id="字符串和日期"><a href="#字符串和日期" class="headerlink" title="字符串和日期"></a>字符串和日期</h3><blockquote>
<p>关于日期模板</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">(在format字符串中可用标志符:  </span><br><span class="line">　%m 月名字(january……december)    </span><br><span class="line">　%w 星期名字(sunday……saturday)    </span><br><span class="line">　%d 有英语前缀的月份的日期(1st, 2nd, 3rd, 等等。）    </span><br><span class="line">　%Y 年, 数字, 4 位    </span><br><span class="line">　%y 年, 数字, 2 位    </span><br><span class="line">　%a 缩写的星期名字(sun……sat)    </span><br><span class="line">　%d 月份中的天数, 数字(00……31)    </span><br><span class="line">　%e 月份中的天数, 数字(0……31)    </span><br><span class="line">　%m 月, 数字(01……12)    </span><br><span class="line">　%c 月, 数字(1……12)    </span><br><span class="line">　%b 缩写的月份名字(jan……dec)    </span><br><span class="line">　%j 一年中的天数(001……366)    </span><br><span class="line">　%H 24时制小时(00……23)    </span><br><span class="line">　%k 小时(0……23)    </span><br><span class="line">　%h 12时小时(01……12)    </span><br><span class="line">　%i 小时(01……12)    </span><br><span class="line">　%l 小时(1……12)    </span><br><span class="line">　%i 分钟, 数字(00……59)    </span><br><span class="line">　%r 时间,12 小时(hh:mm:ss [ap]m)    </span><br><span class="line">　%t 时间,24 小时(hh:mm:ss)    </span><br><span class="line">　%s 秒(00……59)       </span><br><span class="line">　%p am或pm    </span><br><span class="line">　%w 一个星期中的天数(0=sunday ……6=saturday ）  </span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<blockquote>
<ol>
<li><p>获取当前系统的日期</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select now();</span><br><span class="line"></span><br><span class="line">+---------------------+</span><br><span class="line">| now()               |</span><br><span class="line">+---------------------+</span><br><span class="line">| 2022-08-05 11:09:49 |</span><br><span class="line">+---------------------+</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>日期转换成指定格式的字符串 - date_format(日期,模板)</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">模板  %Y   %m    %d  %H  %i   %s</span><br><span class="line"></span><br><span class="line">select date_format(now(),'%Y/%m/%d %H:%i:%s');</span><br><span class="line"></span><br><span class="line">select date_format(now(),'%Y年%m月%d日 %H时%i分%s秒');</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>字符串转成日期 - str_to_date(字符串,模板) - 字符串格式要和模板的格式匹配</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">-- 删除表</span><br><span class="line">drop table tt;</span><br><span class="line">-- 创建表</span><br><span class="line">create table tt(</span><br><span class="line">	id int(7) primary key,</span><br><span class="line">  name varchar(20),</span><br><span class="line">  birthday date</span><br><span class="line">);</span><br><span class="line">   </span><br><span class="line">-- date - 年月日</span><br><span class="line">-- 插入数据</span><br><span class="line">-- mysql中默认支持的格式 - 会将字符串自动转成date类型</span><br><span class="line">insert into tt values(1,'admin','2022-09-01');//ok</span><br><span class="line">insert into tt values(2,'tom','2022/09/01');//ok</span><br><span class="line">insert into tt values(3,'jack','20221001');//ok</span><br><span class="line">   </span><br><span class="line">-- 不支持的时候</span><br><span class="line">insert into tt values(4,'jack','aa');</span><br><span class="line">ERROR 1292 (22007): Incorrect date value: 'aa' for column 'birthday' at row 1</span><br><span class="line">   </span><br><span class="line">insert into tt values(4,'jack','01-05-2022');</span><br><span class="line">ERROR 1292 (22007): Incorrect date value: '01-05-2022' for column 'birthday' at row 1</span><br><span class="line">   </span><br><span class="line">-- 非要使用'01-05-2022'字符串格式的,才需要使用str_to_date函数进行转换</span><br><span class="line">insert into tt values(4,'jack',str_to_date('01-05-2022','%d-%m-%Y'));</span><br></pre></td></tr></tbody></table></figure>

<p><code>导入脚本的时候 - 失败场景 - 字符串日期格式不支持</code></p>
</li>
</ol>
</blockquote>
<h1 id="单行函数"><a href="#单行函数" class="headerlink" title="单行函数"></a>单行函数</h1><blockquote>
<ul>
<li><p>select 函数(参数);</p>
</li>
<li><p>函数是可以应用在查询列上的.</p>
</li>
<li><p>函数是允许嵌套使用的.</p>
</li>
</ul>
</blockquote>
<h2 id="1-字符串函数"><a href="#1-字符串函数" class="headerlink" title="1. 字符串函数"></a>1. 字符串函数</h2><blockquote>
<ol>
<li><p>instr(str,substr) - 返回字符串substr在字符串str第一次出现的位置(str不包含substr时返回0)</p>
</li>
<li><p>lpad(str,len,padstr) - 用字符串padstr填补str左端直到字串长度为len并返回 </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select lpad('ab',5,'cd');//cdcab</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>rpad(str,len,padstr) - 用字符串padstr填补str右端直到字串长度为len并返回</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select rpad('ab',5,'cd');//abcdc   5代表的是总的长度</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>left(str,len) - 返回字符串str的左端len个字符 </p>
</li>
<li><p>right(str,len) - 返回字符串str的右端len个字符 </p>
</li>
<li><p>substring(str,pos,len) - 返回字符串str的位置pos起len个字符  </p>
</li>
<li><p>substring(str,pos) - 返回字符串str的位置pos起后面的子串 </p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">序号从1开始</span><br><span class="line">select substring('mysql',2);  //ysql</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>ltrim(str) - 返回删除了左空格的字符串str  </p>
</li>
<li><p>rtrim(str)  - 返回删除了右空格的字符串str  </p>
</li>
<li><p>space(n) - 返回由n个空格字符组成的一个字符串  </p>
</li>
<li><p><em><strong>replace(str,from_str,to_str)  - 用字符串to_str替换字符串str中的子串from_str并返回</strong></em></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select replace('i love java','java','mysql');</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>reverse(str) - 颠倒字符串str的字符顺序并返回</p>
</li>
<li><p>insert(str,pos,len,newstr) - 把字符串str由位置pos起len个字符长的子串替换为字符串</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select insert('xxxxx',1,2,'**');</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>lower(str) - 返回小写的字符串str  </p>
</li>
<li><p>upper(str) - 返回大写的字符串str</p>
</li>
<li><p>char_length(str) -  不管汉字还是数字或者是字母都算是一个字符。</p>
</li>
<li><p>length(str);//汉字占3个,其他占1个.</p>
</li>
</ol>
</blockquote>
<h3 id="练习-3"><a href="#练习-3" class="headerlink" title="练习"></a>练习</h3><blockquote>
<ol>
<li><p>配合表 - 将first_name全部转换成大写</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select first_name,upper(first_name) from s_emp;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>first_name  - 模拟银行账户显示,只显示首字母,其余每个字母用*表示</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-- substring和rpad</span><br><span class="line">select first_name,rpad(substring(first_name,1,1),char_length(first_name),'*') from s_emp;</span><br><span class="line"></span><br><span class="line">-- concat + substring + rpad</span><br><span class="line">select first_name,concat(substring(first_name,1,1),rpad('*',char_length(first_name)-1,'*')) from s_emp;</span><br><span class="line"></span><br><span class="line">-- replace + substring + rpad</span><br><span class="line">select first_name,replace(first_name,substring(first_name,2),rpad('*',char_length(first_name)-1,'*'))</span><br><span class="line">from s_emp;</span><br><span class="line"></span><br><span class="line">-- insert + rpad</span><br><span class="line">select first_name,insert(first_name,2,char_length(first_name)-1,rpad('*',char_length(first_name)-1,'*'))</span><br><span class="line">from s_emp;</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</blockquote>
<h2 id="2-数字函数"><a href="#2-数字函数" class="headerlink" title="2. 数字函数"></a>2. 数字函数</h2><blockquote>
<ol>
<li>abs(n) - 求绝对值</li>
<li>mod(n,m) - 取模运算,返回n被m除的余数(同%操作符)</li>
<li><strong>floor(n) - 返回不大于n的最大整数值</strong> - 向下取整  </li>
<li><strong>ceiling(n) - 返回不小于n的最小整数值</strong>  - 向上取整 </li>
<li>round(n[,d]) - 返回n的四舍五入值,保留d位小数(d的默认值为0)</li>
<li>pow(x,y) - 返回值x的y次幂  </li>
<li>sqrt(n) - 返回非负数n的平方根</li>
<li>pi() - 返回圆周率  </li>
<li>rand() - 返回在范围[0到1.0)内的随机浮点值</li>
<li>truncate(n,d) - 保留数字n的d位小数并返回  - 直接截取</li>
</ol>
</blockquote>
<h2 id="3-日期函数"><a href="#3-日期函数" class="headerlink" title="3. 日期函数"></a>3. 日期函数</h2><blockquote>
<p>查询当前系统的日期 - select now();</p>
<ol>
<li><p>dayofweek(date) - 返回日期date是星期几(1=星期天,2=星期一,……7=星期六,odbc标准)  </p>
</li>
<li><p>weekday(date) - 返回日期date是星期几(0=星期一,1=星期二,……6= 星期天)</p>
</li>
<li><p>year(date) - 返回date的年份(范围在1000到9999)    </p>
</li>
<li><p>month(date)  - 返回date中的月份数值   </p>
</li>
<li><p>dayofmonth(date) - 返回date是一月中的第几日(在1到31范围内)   </p>
</li>
<li><p>hour(time) - 返回time的小时数(范围是0到23)  </p>
</li>
<li><p>minute(time) - 返回time的分钟数(范围是0到59) </p>
</li>
<li><p>second(time) - 返回time的秒数(范围是0到59) </p>
</li>
<li><p>period_add(p,n) - 增加n个月到时期p并返回(p的格式yymm或yyyymm) </p>
<p>mysql&gt;select period_add(‘202008’,3) ;</p>
<p>注意:p可以是字符串,一定要满足一定的格式,或者可以直接使用date类型.</p>
</li>
<li><p>period_diff(p1,p2) - 返回在时期p1和p2之间月数(p1和p2的格式yymm或yyyymm)  p1-p2</p>
</li>
<li><p>curdate() - 以’yyyy-mm-dd’或yyyymmdd格式返回当前日期值(根据返回值所处上下文是字符串或数字) </p>
</li>
<li><p>curtime() - 以’hh:mm:ss’或hhmmss格式返回当前时间值(根据返回值所处上下文是字符串或数字)</p>
</li>
<li><p>now() - 以’yyyy-mm-dd hh:mm:ss’或yyyymmddhhmmss格式返回当前日期时间(根据返回值所处上下文是字符串或数字)     </p>
</li>
<li><p>last_day(date) - date日期所在月的最后一天是什么时候</p>
</li>
<li><p>datediff(d1,d2) - 两个日期d1,d2之间相差的天数</p>
</li>
<li><p>timestampdiff(type,d1,d2) - type是YEAR,d1和d2相差的年份,MONTH,月份</p>
<p>d1,d2 - yyyymmdd</p>
</li>
</ol>
</blockquote>
<h3 id="3-1-补充"><a href="#3-1-补充" class="headerlink" title="3-1. 补充"></a>3-1. 补充</h3><blockquote>
<ul>
<li><p>date_add(date,interval expr type)</p>
</li>
<li><p>date_sub(date,interval expr type)</p>
</li>
<li><p>关于type</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ype:</span><br><span class="line">year</span><br><span class="line">month</span><br><span class="line">day</span><br><span class="line">hour</span><br><span class="line">minute</span><br><span class="line">second</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
</blockquote>
<p>#关联查询 </p>
<blockquote>
<p>关联查询就是多表查询</p>
</blockquote>
<h2 id="错误的写法"><a href="#错误的写法" class="headerlink" title="错误的写法"></a>错误的写法</h2><blockquote>
<p>s_emp表中25rows,s_dept表中12rows</p>
<ol>
<li><p>查询员工的名字以及这个员工的部门名称</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select first_name,name from s_emp,s_dept;</span><br><span class="line"></span><br><span class="line">300 rows </span><br><span class="line"></span><br><span class="line">发生了笛卡尔积 - 错误的结果</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</blockquote>
<h3 id="纠正-传统的写法"><a href="#纠正-传统的写法" class="headerlink" title="纠正 - 传统的写法"></a>纠正 - 传统的写法</h3><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">select first_name,name from s_emp,s_dept where dept_id=id;</span><br><span class="line"></span><br><span class="line">ERROR 1052 (23000): Column 'id' in where clause is ambiguous</span><br><span class="line"></span><br><span class="line">多张表中出现同名的列,需要对表取别名</span><br><span class="line"></span><br><span class="line">正确的写法:</span><br><span class="line">select e.first_name,d.name from s_emp e,s_dept d where e.dept_id=d.id;</span><br><span class="line"></span><br><span class="line">-- 用来表示表与表之间的关系foreign key - 外键</span><br><span class="line"></span><br><span class="line">-- 查询这个员工的first_name以及这个员工所在的区域名.</span><br><span class="line">-- 一个区域对应多个部门,一个部门对应多个员工.</span><br><span class="line">select e.first_name,r.name from s_emp e,s_dept d,s_region r</span><br><span class="line">where d.region_id = r.id and e.dept_id = d.id;</span><br><span class="line"></span><br><span class="line">for( ...  s_emp e){</span><br><span class="line">	for(... s_dept d){</span><br><span class="line">	    if(e.dept_id==d.id){</span><br><span class="line">	      e+":"+d</span><br><span class="line">	    }</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="join和on写法"><a href="#join和on写法" class="headerlink" title="join和on写法"></a>join和on写法</h2><blockquote>
<p>如果一条sql语句涉及到的表比较多的话,传统的写法,就不能很直观的看出来哪个表和哪个表之间有直接的关系.</p>
<p>表 join 表 on 去除笛卡尔积</p>
<p>外键一定是出现在多的一方</p>
<p><em><strong>on 多的一方的外键 = 一的一方主键</strong></em></p>
<p><code>但是也不一定非要使用外键来去除笛卡尔积</code></p>
</blockquote>
<blockquote>
<p>规则: 能够用join连接的表之间必须要有直接的关系.</p>
</blockquote>
<h3 id="练习-4"><a href="#练习-4" class="headerlink" title="练习"></a>练习</h3><blockquote>
<ol>
<li><p>找出查询员工的名字以及这个员工的部门名称</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select e.first_name,d.name from s_emp e join s_dept d on e.dept_id = d.id;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>找出’Asia’区域上的所有的员工</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">select e.first_name,r.name from </span><br><span class="line">s_emp e join s_dept d</span><br><span class="line">on e.dept_id = d.id</span><br><span class="line">join s_region r</span><br><span class="line">on d.region_id = r.id</span><br><span class="line">where r.name='Asia';</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>找出客户的id,名称,联系方式以及这个客户的订单信息</p>
<p>‘问题 - 15rows - [201,215]’</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select c.id,c.name,c.phone,o.* from s_customer c</span><br><span class="line">join s_ord o on c.id = o.customer_id;</span><br><span class="line"></span><br><span class="line">查询出来的结果缺了id=207和215俩个客户,因为这俩个客户没有订单,所以这俩个客户没有查询出来.</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</blockquote>
<h2 id="连接的方式"><a href="#连接的方式" class="headerlink" title="连接的方式"></a>连接的方式</h2><blockquote>
<ol>
<li><p>内连接 - [inner] join</p>
<p><code>如果join左边的表在右边的表中如果不存记录,则不会被查询出来.</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select c.id,c.name,c.phone,o.id from s_customer c</span><br><span class="line">inner join s_ord o on c.id = o.customer_id;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>左连接 - left join</p>
<p><code>以左边的表为基准表.即使左边的表在右边的表中没有记录,那么左边表中的这条记录也要能够被查询出来</code></p>
<p><code>查询客户和订单信息,即使这个客户没有订单,那么这个客户也要能够被查询出来</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select c.id,c.name,c.phone,o.id from s_customer c</span><br><span class="line">left join s_ord o on c.id = o.customer_id;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>右连接 - right join</p>
<p><code>以右边的表为基准表.即使右边的表在左边的表中没有记录,那么右边表中的这条记录也要能够被查询出来</code></p>
<p><code>查询客户和订单信息,即使这个客户没有订单,那么这个客户也要能够被查询出来</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select c.id,c.name,c.phone,o.id from s_ord o</span><br><span class="line">right join s_customer c on c.id = o.customer_id;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>交叉连接 - cross join - 不会使用的,产生的是一个错误的结果集 - 笛卡尔积</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select c.id,c.name,c.phone,o.id from s_customer c</span><br><span class="line">cross join s_ord o;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>全连接 full outer join - mysql不支持</p>
<p>全连接 = 左连接 + 右连接</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">drop table t_user;</span><br><span class="line">drop table t_info;</span><br><span class="line">create table t_user(</span><br><span class="line">	id int primary key,</span><br><span class="line">  name varchar(20)</span><br><span class="line">);</span><br><span class="line">insert into t_user values(1,'admin');</span><br><span class="line">insert into t_user values(2,'python');</span><br><span class="line"></span><br><span class="line">create table t_info(</span><br><span class="line">	id int primary key,</span><br><span class="line">	remark varchar(20),</span><br><span class="line">	user_id int</span><br><span class="line">);</span><br><span class="line">insert into t_info values(1,'aaa',1);</span><br><span class="line">insert into t_info values(2,'bbb',3);</span><br><span class="line"></span><br><span class="line">-- 分析 - 左连接</span><br><span class="line">select u.*,info.* from t_user u left join t_info info on u.id = info.user_id;</span><br><span class="line">+----+--------+------+--------+---------+</span><br><span class="line">| id | name   | id   | remark | user_id |</span><br><span class="line">+----+--------+------+--------+---------+</span><br><span class="line">|  1 | admin  |    1 | aaa    |       1 |</span><br><span class="line">|  2 | python | NULL | NULL   |    NULL |</span><br><span class="line">+----+--------+------+--------+---------+</span><br><span class="line"></span><br><span class="line">-- 右连接</span><br><span class="line">select info.*,u.* from t_user u right join t_info info on u.id = info.user_id;</span><br><span class="line">+----+--------+---------+------+-------+</span><br><span class="line">| id | remark | user_id | id   | name  |</span><br><span class="line">+----+--------+---------+------+-------+</span><br><span class="line">|  1 | aaa    |       1 |    1 | admin |</span><br><span class="line">|  2 | bbb    |       3 | NULL | NULL  |</span><br><span class="line">+----+--------+---------+------+-------+</span><br><span class="line"></span><br><span class="line">-- 全连接</span><br><span class="line">union - 两张表中的重复的结果保留了一条 </span><br><span class="line"></span><br><span class="line">union all - 两张表中的重复的结果都会展示出来 , 并集</span><br><span class="line"></span><br><span class="line">select u.*,info.* from t_user u left join t_info info on u.id = info.user_id</span><br><span class="line">union all</span><br><span class="line">select u.*,info.* from t_user u right join t_info info on u.id = info.user_id;</span><br><span class="line"></span><br><span class="line"> id   | name   | id   | remark | user_id |</span><br><span class="line">+------+--------+------+--------+---------+</span><br><span class="line">|    1 | admin  |    1 | aaa    |       1 |</span><br><span class="line">|    2 | python | NULL | NULL   |    NULL |</span><br><span class="line">|    1 | admin  |    1 | aaa    |       1 |</span><br><span class="line">| NULL | NULL   |    2 | bbb    |       3 |</span><br><span class="line">+------+--------+------+--------+---------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">select u.*,info.* from t_user u left join t_info info on u.id = info.user_id</span><br><span class="line">union </span><br><span class="line">select u.*,info.* from t_user u right join t_info info on u.id = info.user_id;</span><br><span class="line"></span><br><span class="line">+------+--------+------+--------+---------+</span><br><span class="line">| id   | name   | id   | remark | user_id |</span><br><span class="line">+------+--------+------+--------+---------+</span><br><span class="line">|    1 | admin  |    1 | aaa    |       1 |</span><br><span class="line">|    2 | python | NULL | NULL   |    NULL |</span><br><span class="line">| NULL | NULL   |    2 | bbb    |       3 |</span><br><span class="line">+------+--------+------+--------+---------+</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</blockquote>
<h3 id="练习-5"><a href="#练习-5" class="headerlink" title="练习"></a>练习</h3><blockquote>
<p>查询员工的名称以及他对应的上司的名称,即使这个员工没有上司,那么也要查询出来 - 自关联</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select e1.first_name 员工,e2.first_name 上司</span><br><span class="line">from s_emp e1 left join s_emp e2 on e2.id = e1.manager_id;</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<h1 id="多行函数"><a href="#多行函数" class="headerlink" title="多行函数"></a>多行函数</h1><blockquote>
<ol>
<li><p>count - 统计个数,null值不会统计,重复的数据,有一个算一个</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select count(*) from s_emp;</span><br><span class="line"></span><br><span class="line">select count(e.id) from s_emp e;</span><br><span class="line"></span><br><span class="line">select count(e.commission_pct) from s_emp;//5个</span><br><span class="line"></span><br><span class="line">-- 统计职称的个数,但是重复的职称只能算1个</span><br><span class="line">select count(distinct title) from s_emp;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>sum - 总和,忽略null值</p>
</li>
<li><p>avg,max,min</p>
</li>
</ol>
</blockquote>
<h1 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h1><blockquote>
<p><code>分组统计</code></p>
</blockquote>
<blockquote>
<p><code>语法</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT 语句</span><br><span class="line">WHERE 语句</span><br><span class="line">GROUP BY 语句</span><br><span class="line">HAVING 语句</span><br><span class="line">ORDER BY 语句</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<h2 id="练习-6"><a href="#练习-6" class="headerlink" title="练习"></a>练习</h2><blockquote>
<ol>
<li><p>统计每个部门的员工的个数 - 单表</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select e.dept_id,count(e.id) from s_emp e group by e.dept_id;</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li><p>统计部门的id,name以及这个部门的员工的个数</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-- group by + d.id  --- ok   id是主键列 - 唯一性</span><br><span class="line">select d.id,d.name,count(e.id) from s_emp e</span><br><span class="line">join s_dept d on e.dept_id = d.id group by d.id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">select d.id,d.name,count(e.id) from s_emp e</span><br><span class="line">join s_dept d on e.dept_id = d.id group by d.name;</span><br><span class="line">ERROR 1055 (42000): Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column 'dy.d.id' which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by</span><br><span class="line"></span><br><span class="line">-- 推荐select后面跟的列(除了组函数/多行函数)应该和group by 跟的列保持一致</span><br><span class="line">select d.id,d.name,count(e.id) from s_emp e</span><br><span class="line">join s_dept d on e.dept_id = d.id group by d.id,d.name;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>统计每个职称的人数</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select title,count(*) from s_emp group by title;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>统计区域id,区域名,以及这个区域上的员工的个数</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select r.id,r.name,count(e.id) from s_region r join s_dept d</span><br><span class="line">on d.region_id = r.id join s_emp e on e.dept_id = d.id group by r.id,r.name;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>统计客户的id,name以及这个客户的订单的数量,没有订单,则显示0</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select c.id,c.name,count(o.id) from s_customer c left join s_ord o</span><br><span class="line">on o.customer_id = c.id group by c.id,c.name;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>统计各年份入职的员工(年份,员工数量)</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select year(start_date),count(e.id) from s_emp e</span><br><span class="line">group by year(start_date);</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</blockquote>
<h3 id="having使用方式"><a href="#having使用方式" class="headerlink" title="having使用方式"></a>having使用方式</h3><blockquote>
<p>having和where区别</p>
<ol>
<li>where条件筛选,但是分组之前,并且where不会跟组函数</li>
<li>having分组之后的进一步过滤,使用组函数进行过滤的</li>
</ol>
</blockquote>
<p><code>练习</code></p>
<blockquote>
<ol>
<li><p>查询出平均工资超过1300的部门 - 部门id,name,平均工资</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select d.id,d.name,avg(e.salary) from s_dept d join s_emp e</span><br><span class="line">on d.id = e.dept_id group by d.id,d.name having avg(e.salary)&gt;1300;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>统计除了’Asia’区域之外的各个区域的id,name和区域上的人数[大于3个],最后再根据区域的id进行降序排列</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select r.id,r.name,count(e.id) from s_region r </span><br><span class="line">join s_dept d on r.id = d.region_id</span><br><span class="line">join s_emp e on e.dept_id = d.id</span><br><span class="line">where r.name&lt;&gt;'Asia'</span><br><span class="line">group by r.id,r.name</span><br><span class="line">having count(e.id)&gt;3</span><br><span class="line">order by 1 desc;</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>查询没有订单的客户</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select c.id,c.name,count(o.id) from s_customer c</span><br><span class="line">left join s_ord o on c.id = o.customer_id group by c.id,c.name having count(o.id)=0;</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</blockquote>
<h1 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h1><blockquote>
<p>子查询必须使用()括起来</p>
<ul>
<li>条件列</li>
<li>查询列</li>
<li>子查询的结果看做是”一张表”</li>
</ul>
</blockquote>
<p><code>练习</code></p>
<blockquote>
<ol>
<li><p>查找和Mark工资一样的员工.</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-- 分解 - mark工资 - 1450</span><br><span class="line">select salary from s_emp where first_name='Mark';</span><br><span class="line"></span><br><span class="line">-- 找出1450薪资的员工</span><br><span class="line">select first_name,salary from s_emp where salary = 1450 and first_name&lt;&gt;'Mark';</span><br><span class="line"></span><br><span class="line">-- 整合</span><br><span class="line">-- 子查询出现在条件部分</span><br><span class="line">select first_name,salary from s_emp where salary = (select salary from s_emp where first_name='Mark')  and first_name&lt;&gt;'Mark';</span><br></pre></td></tr></tbody></table></figure>
</li>
<li><p>统计每个部门的id,name以及部门的员工的个数</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select d.id,d.name,(</span><br><span class="line">	select count(e.id) from s_emp e where e.dept_id = d.id</span><br><span class="line">) from s_dept d;</span><br></pre></td></tr></tbody></table></figure></li>
</ol>
</blockquote>
<p><code>练习2</code></p>
<blockquote>
<ol>
<li>统计客户的id,name以及客户的订单数量</li>
</ol>
 <figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select c.id,c.name,(select count(o.id) from s_ord o where o.customer_id = c.id) from s_customer c;</span><br></pre></td></tr></tbody></table></figure>

<ol start="2">
<li>找出部门平均工资高于公司平均工资的部门信息</li>
</ol>
 <figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select dept_id,avg(salary) from s_emp group by dept_id having avg(salary)&gt;(select avg(salary) from s_emp);</span><br></pre></td></tr></tbody></table></figure>

<ol start="3">
<li>找出与’Ben’同部门的员工信息</li>
</ol>
 <figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-- 方式一</span><br><span class="line">select first_name,dept_id from s_emp where dept_id=(select dept_id from s_emp where first_name='Ben')</span><br><span class="line">and first_name&lt;&gt;'Ben';</span><br><span class="line"></span><br><span class="line">-- 方式二</span><br><span class="line">select e.first_name,(select e.dept_id from s_emp e1 where e1.first_name='Ben' and e1.dept_id=e.dept_id) did from s_emp e where e.first_name&lt;&gt;'Ben';</span><br><span class="line"></span><br><span class="line">-- 方式二整合 - 把子查询的结果作为一张表,必须要别名</span><br><span class="line">select * from (select e.first_name,(select e.dept_id from s_emp e1 where e1.first_name='Ben' and e1.dept_id=e.dept_id) did from s_emp e where e.first_name&lt;&gt;'Ben') core_</span><br><span class="line">where core_.did is not null;</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><blockquote>
<ol>
<li><p>能用分组查询查询就不要使用子查询(嵌套越多,查询效率越低)</p>
</li>
<li><p>无关子查询(子查询可以独立运行)和相关子查询(子查询使用到了外部查询的东西)</p>
<p>无关子查询&gt;相关子查询</p>
</li>
<li><p>子查询会比分组查询更加灵活.</p>
</li>
</ol>
</blockquote>
<h1 id="exists和not-exists"><a href="#exists和not-exists" class="headerlink" title="exists和not exists"></a>exists和not exists</h1><blockquote>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SELECT 语句</span><br><span class="line">WHERE exists (子查询)</span><br><span class="line"></span><br><span class="line">规则: 不关心子查询查到的内容是什么,子查询是否能够查询出结果.</span><br><span class="line">如果查询出结果,等同于where true</span><br><span class="line"></span><br><span class="line">select id,first_name from s_emp where exists(select 1 from s_emp where 1=1);</span><br></pre></td></tr></tbody></table></figure>

<p><code>找出和'Ben'同一个部门的员工</code></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">select e.first_name,e.dept_id from s_emp e </span><br><span class="line">where exists(</span><br><span class="line">select 1 from s_emp e1 where e1.first_name='Ben' and e1.dept_id = e.dept_id</span><br><span class="line">) and e.first_name&lt;&gt;'Ben';</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p><code>练习</code></p>
<blockquote>
<p>找出各个部门工资排名前二的员工</p>
<p>思路: 在’我’这个部门中,有人的工资比我高,但是数量不能超过1个</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select e.id,e.salary,e.dept_id from s_emp e</span><br><span class="line">where exists(</span><br><span class="line">	select 1 from s_emp e1 where e1.dept_id = e.dept_id and</span><br><span class="line">e1.salary&gt;e.salary having count(*)&lt;=1</span><br><span class="line">) order by 3;</span><br></pre></td></tr></tbody></table></figure>
</blockquote>
<p><code>练习</code></p>
<blockquote>
<p>找出每个部门中工资最高的那个人</p>
</blockquote>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/08/09/mysql2/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">&lt;</strong>
      <div class="article-nav-title">
        
          mysql2
        
      </div>
    </a>
  
  
    <a href="/2022/08/09/%E7%B4%A2%E5%BC%95/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">索引</div>
      <strong class="article-nav-caption">&gt;</strong>
    </a>
  
</nav>

  
</article>






</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2022 ape_li
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/preccrep/hexo-theme-jelly" target="_blank">Jelly</a>
        </div>
    </div>
  </div>
</footer>
    </div>
    
  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">



<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>

<script src="/js/main.js"></script>




  </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>